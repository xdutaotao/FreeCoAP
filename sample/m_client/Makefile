ifeq ($(ip6),y)
IP6_CFLAGS = -DCOAP_IP6
endif
ifneq ($(dtls),n)
DTLS_CFLAGS = -DCOAP_DTLS_EN
DTLS_LIBS = -lgmp \
            -lhogweed \
            -lnettle \
            -lgnutls
endif
ifeq ($(tcp),y)
TCP_CFLAGS = -DUSE_TCP
endif
I1 = ../../lib/include
S1 = ../../lib/src
CC_ ?= gcc
CFLAGS = -Wall \
         -I$(I1)
CFLAGS += $(IP6_CFLAGS)
CFLAGS += $(DTLS_CFLAGS)
CFLAGS += $(TCP_CFLAGS)
LD_ ?= gcc
LDFLAGS =
INCS = m_client.h \
       $(I1)/coap_client.h \
       $(I1)/coap_msg.h \
       $(I1)/coap_mem.h \
       $(I1)/coap_log.h \
       $(I1)/coap_ipv.h
OBJS = main.o \
       m_client.o \
       coap_client.o \
       coap_msg.o \
       coap_mem.o \
       coap_log.o
LIBS = $(DTLS_LIBS)
PROG = m_client
RM = /bin/rm -f

$(PROG): $(OBJS)
	$(LD_) $(LDFLAGS) $(OBJS) -o $(PROG) $(LIBS)

main.o: main.c $(INCS)
	$(CC_) $(CFLAGS) -c main.c

m_client.o: m_client.c $(INCS)
	$(CC_) $(CFLAGS) -c m_client.c

coap_client.o: $(S1)/coap_client.c $(INCS)
	$(CC_) $(CFLAGS) -c $(S1)/coap_client.c

coap_msg.o: $(S1)/coap_msg.c $(INCS)
	$(CC_) $(CFLAGS) -c $(S1)/coap_msg.c

coap_mem.o: $(S1)/coap_mem.c $(INCS)
	$(CC_) $(CFLAGS) -c $(S1)/coap_mem.c

coap_log.o: $(S1)/coap_log.c $(INCS)
	$(CC_) $(CFLAGS) -c $(S1)/coap_log.c

clean:
	$(RM) $(PROG) $(OBJS)
